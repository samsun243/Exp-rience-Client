<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGRC Admin - Statistiques</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/svg+xml" href="logo.svg">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="with-sidebar">
    <div id="navbar-container"></div>
    <div id="sidebar-container"></div>

    <div class="main-content">
        <main class="container-fluid py-4 reveal">
            <div class="mb-5">
                <h1 class="display-5 fw-800 mb-1">Analytics <span class="text-primary">& Insights</span></h1>
                <p class="text-muted fs-6">Analyse de la performance et distribution des requêtes.</p>
            </div>

            <div class="row g-4">
                <!-- Evolution Chart -->
                <div class="col-lg-8">
                    <div class="bento-card h-100">
                        <h5 class="fw-800 mb-4">Évolution des réclamations</h5>
                        <canvas id="evolutionChart" style="max-height: 400px;"></canvas>
                    </div>
                </div>

                <!-- Distribution Chart -->
                <div class="col-lg-4">
                    <div class="bento-card h-100">
                        <h5 class="fw-800 mb-4">Par Catégorie</h5>
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

                <!-- Priority Levels -->
                <div class="col-lg-12">
                    <div class="bento-card">
                        <h5 class="fw-800 mb-4">Niveaux de Priorité</h5>
                        <div id="priority-stats">
                            <!-- Content loaded via JS -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            renderCharts();
        });

        function renderCharts() {
            const complaints = getComplaints();

            // Category Distribution
            const categories = {};
            complaints.forEach(c => {
                categories[c.category] = (categories[c.category] || 0) + 1;
            });

            new Chart(document.getElementById('categoryChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categories),
                    datasets: [{
                        data: Object.values(categories),
                        backgroundColor: ['#0d6efd', '#198754', '#ffc107', '#dc3545', '#6c757d']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });

            // Evolution Chart (Dummy data based on current complaints)
            new Chart(document.getElementById('evolutionChart'), {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Nombre de réclamations',
                        data: [12, 19, 3, 5, 2, complaints.length],
                        borderColor: '#0d6efd',
                        tension: 0.1
                    }]
                }
            });

            // Priority Progress Bar
            const total = complaints.length || 1;
            const high = complaints.filter(c => c.priority === 'Haute').length;
            const medium = complaints.filter(c => c.priority === 'Moyenne').length;
            const low = complaints.filter(c => c.priority === 'Basse').length;

            const highPct = (high / total * 100).toFixed(1);
            const mediumPct = (medium / total * 100).toFixed(1);
            const lowPct = (low / total * 100).toFixed(1);

            document.getElementById('priority-high-bar').style.width = highPct + '%';
            document.getElementById('priority-high-bar').textContent = high > 0 ? `Haute (${highPct}%)` : '';

            document.getElementById('priority-medium-bar').style.width = mediumPct + '%';
            document.getElementById('priority-medium-bar').textContent = medium > 0 ? `Moyenne (${mediumPct}%)` : '';

            document.getElementById('priority-low-bar').style.width = lowPct + '%';
            document.getElementById('priority-low-bar').textContent = low > 0 ? `Basse (${lowPct}%)` : '';
        }
    </script>
</body>

</html>